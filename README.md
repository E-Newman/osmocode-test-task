# CRouter.check_route_rules

[CRouter.check_route_rules(\$rules)](./CRouter.php) - проверяет маршрут (URL и параметры запроса) на соответствие правилам, указанным в массиве `$rules`.

**Формат входных данных:** многоуровневый массив правил маршрутизации. Каждое правило может иметь следующие свойства:

- `name` - имя проверяемого параметра;
- `type` - тип правила:
  - `and` - правило выполняется, только когда выполняются все вложенные в него правила;
  - `or` - правило выполняется, когда выполняется хотя бы одно вложенное в него правило;
  - `request_var` - правило проверяет переменную запроса (из массива `$_REQUEST`) с именем, заданным свойством `name`;
  - `request_uri` - правило проверяет URI запроса (переменную `$_SERVER["REQUEST_URI"]`);
- `regexp` - регулярное выражение, которому должно соответствовать значение проверяемого параметра;
- `value` - константное значение проверяемого параметра или строка `"any"`, если разрешено любое значение параметра;
- `parameters` - значения параметров маршрута, которые извлекаются из проверяемого параметра и сохраняются в свойстве `$routing_parameters` роутера;
- `default_parameters` - значения параметров маршрута по умолчанию, которые извлекаются из проверяемого параметра и сохраняются в свойстве `$routing_parameters` роутера.

**Возвращаемое значение**: 1, если маршрут соответствует правилам, 0 - иначе.

**Алгоритм работы метода `check_route_rules`:**

1. Если включена отладка (`CDebug::isEnabled()`), то логируется сообщение `check_route_rules`, значение свойства `type` текущего правила и массив `$rules`;
2. если `type == "or"`, то `check_route_rules` рекурсивно вызывается для всех правил, вложенных в текущее; если хотя бы для одного вложенного правила возвращается `1`, метод возвращает `1`, иначе `0`;
3. если `type == "and"`, то `check_route_rules` рекурсивно вызывается для всех правил, вложенных в текущее; если для всех вложенных правил возвращается `1`, метод возвращает `1`, иначе `0`;
4. если тип правила - `request_var`, то значение проверяемого параметра извлекается из `$_REQUEST[$rules["name"]]`;
5. если тип правила - `request_uri`, то значение проверяемого параметра извлекается из `$_SERVER["REQUEST_URI"]`;
6. если определено свойство правила `regexp`:
  - если значение проверяемого параметра соответствует регулярному выражению, заданному свойством `regexp`, то метод возвращает `1`;
  - также, если определены свойства правила `default_parameters` или `parameters`, в свойство `routing_parameters` роутера записываются их значения;
7. если свойство `type` определено, но не является одним из `or, and. request_var, request_uri` и включена отладка, то логируется сообщение `unknown rule` и массив `$rules`;
8. если свойство `type` не определено, то поведение `check_route_rules` аналогично случаю, когда `type == "and"`, `check_route_rules` рекурсивно вызывается для всех правил, вложенных в текущее; если для всех вложенных правил возвращается `1`, метод возвращает `1`, иначе `0`.

**Пример:**

Пусть имеется следующий массив правил:

```php
$rules = array(
    "type" => "or",
    "rules" => array(
        array(
            "type" => "request_var",
            "name" => "page",
            "value" => "home"
        ),
        array(
            "type" => "and",
            "rules" => array(
                array(
                    "type" => "request_var",
                    "name" => "category",
                    "value" => "news"
                ),
                array(
                    "type" => "request_var",
                    "name" => "id",
                    "regexp" => "\d+"
                )
            )
        ),
        array(
            "type" => "request_uri",
            "regexp" => "user\d+\.html"
        )
    )
);
```

Пусть поступил запрос, массив `$_REQUEST` которого выглядит так:

```php
$_REQUEST = array(
    "page" => "home",
    "category" => "news",
    "id" => "123"
);
```

Для этого запроса `check_route_rules` выполнится следующим образом:
1. первое правило имеет `type == "or"`, поэтому если хотя бы для одного из вложенных правил `check_route_rules` вернёт `1`, то изначальный вызов `check_route_rules` также вернёт `1`;
2. для первого вложенного правила:
    - `type == "request_var"`;
    - `name == "page"`;
    - `$_REQUEST["page"] == "home"`;
3. для первого вложенного правила `check_route_rules` вернёт 1, поэтому изначальный вызов `check_route_rules` также вернёт `1`.

Пусть поступил запрос к URI `user12w.html`. Массив `$_REQUEST` пустой. Для этого запроса `check_route_rules` выполнится следующим образом:
1. первое правило имеет `type = "or"`, поэтому если хотя бы для одного из вложенных правил `check_route_rules` вернёт `1`, то изначальный вызов `check_route_rules` также вернёт `1`;
2. для правил с `type == "request_var"` `check_route_rules` вернёт 0, поскольку переменные `$_REQUEST["page"], $_REQUEST["category"], $_REQUEST["id"]` не определены;
3. последнее вложенное правило также вернёт `0`, т.к. `user12w.html` не соответствует регулярному выражению `user\d+\.html`;
4. изначальный вызов `check_route_rules` также вернёт `0`.
